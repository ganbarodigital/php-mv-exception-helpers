<!DOCTYPE html>
<html lang="en">
    <head>
        <!--[if lt IE 9]>
            <script src="assets/html5shiv.js"></script>
            <script src="assets/html5printshiv.js"></script>
        <![endif]-->
        <meta charset="utf-8"/>
        <title>Exception Helpers Library for PHP from Ganbaro Digital</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="http://ganbarodigital.github.io/php-mv-exception-helpers/assets/docs.css" rel="stylesheet"/>
        <link rel="stylesheet" href="http://ganbarodigital.github.io/php-mv-exception-helpers/assets/prism.css">
        <script src="http://ganbarodigital.github.io/php-mv-exception-helpers/assets/prism.js"></script>
    </head>
    <body data-ishi-anchors="1">
        <header role="banner">
            <div>
                <p style="font-size: 34px; padding-top: 10px">Exception Helpers Library for PHP</p>
                <p style="font-size: 18px; border-bottom: 1px solid; padding-bottom: 10px">Easy-to-use collection of helpers for your exceptions</p>
            </div>
            <!--<a href="http://ganbarodigital.github.io/php-mv-exception-helpers/index.html">
                <img src="http://ganbarodigital.github.io/php-mv-exception-helpers/assets/ganbarodigital.svg" width="60" height="60" style="vertical-align: middle; float: left; margin-right: 15px">
            </a>-->
            <nav class="navbar topbar">
                <ul>
                                            <li class="">
                            <a class="" href="http://ganbarodigital.github.io/php-mv-exception-helpers/index.html">Overview</a>
                        </li>
                                            <li class="current">
                            <a class="current" href="http://ganbarodigital.github.io/php-mv-exception-helpers/V1/index.html">Version 1.x</a>
                        </li>
                                    </ul>
            </nav>
        </header>
                                                                            <header role="subnav">
                        <nav class="navbar">
                            <ul>
                                                                    <li class="">
                                        <a class="" href="http://ganbarodigital.github.io/php-mv-exception-helpers/V1/index.html">Introduction</a>
                                    </li>
                                                                    <li class="">
                                        <a class="" href="http://ganbarodigital.github.io/php-mv-exception-helpers/V1/BaseExceptions/index.html">Base Exceptions</a>
                                    </li>
                                                                    <li class="current">
                                        <a class="current" href="http://ganbarodigital.github.io/php-mv-exception-helpers/V1/Callers/index.html">Callers</a>
                                    </li>
                                                            </ul>
                        </nav>
                    </header>
                                            <main role="main">
                        <nav class="pageflow">
              <ul>
                                    <li><a href="CodeCaller.html">Prev: CodeCaller class</a></li>
                                                      <li><a href="FilterBacktraceForTwoCodeCallers.html">Next: FilterBacktraceForTwoCodeCallers class</a></li>
                                </ul>
            </nav>
            
            <article>
                <h1 id="filterbacktrace">FilterBacktrace</h1>
<div class="callout info">
<p>Since v1.2016041701</p>
</div>
<h2 id="description">Description</h2>
<p><code>FilterBacktrace</code> is a data filter. You give it the output from <code>debug_backtrace()</code>, and a list of PHP classnames or namespaces to filter, and it will return the first entry in the debug trace that passes the filter.</p>
<p><code>FilterBacktrace</code> was introduced to separate out the low-level filtering code from <code>FilterCodeCaller</code>.</p>
<h2 id="public-interface">Public Interface</h2>
<p><code>FilterBacktrace</code> has the following public interface:</p>
<pre><code class="language-php">namespace GanbaroDigital\ExceptionHelpers\V1\Callers\Filters\FilterBacktrace;

use GanbaroDigital\MissingBits\TraceInspectors\FilterBacktrace as BaseClass;

class FilterBacktrace extends BaseClass
{
    /**
     * work out who has called a piece of code
     *
     * @param  array $backtrace
     *         the debug_backtrace() return value
     * @param  array $filterList
     *         a list of namespaces and classes to skip over
     * @param  int $index
     *         how far down the stack do we want to start looking from?
     * @return array
     */
    public function __invoke($backtrace, $filterList = [], $index = 1);

    /**
     * work out who has called a piece of code
     *
     * @param  array $backtrace
     *         the debug_backtrace() return value
     * @param  array $filterList
     *         a list of namespaces and classes to skip over
     * @param  int $index
     *         how far down the stack do we want to start looking from?
     * @return array
     */
    public static function from($backtrace, $filterList = [], $index = 1);
}</code></pre>
<h2 id="how-to-use">How To Use</h2>
<h3 id="finding-a-single-stack-frame">Finding A Single Stack Frame</h3>
<p><code>FilterBacktrace</code> can be used as an object, or as a static class method.</p>
<pre><code class="language-php">// import first
use GanbaroDigital\ExceptionHelpers\V1\Callers\Filters\FilterBacktrace;

// we need a stack trace
// use DEBUG_BACKTRACE_IGNORE_ARGS to keep the trace very small
$trace = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS);

// we need a list of namespaces to filter out
//
// this can be individual parts of namespaces, or whole classnames
$filterList = [
    'GanbaroDigital\Reflection\V1\Checks',
    'GanbaroDigital\Reflection\V1\Requirements',
    FilterBacktrace::class,
];

// to use as an object
$filter = new FilterBacktrace;
$caller = $filter($trace, $filterList);

// to call statically
$caller = FilterBacktrace::from($trace, $filterList);</code></pre>
<h3 id="finding-multiple-stack-frames">Finding Multiple Stack Frames</h3>
<p><code>debug_backtrace()</code> returns the stack trace as an array. You can start the search from anywhere in this array by passing a third parameter into this filter. This is especially useful if your exception wants to know who called the code that is trying to throw an exception:</p>
<pre><code class="language-php">use GanbaroDigital\ExceptionHelpers\V1\Callers\Filters\FilterBacktrace;

// we need a stack trace
// use DEBUG_BACKTRACE_IGNORE_ARGS to keep the trace very small
$trace = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS);

// starts from the beginning of the stack trace
$caller1 = FilterBacktrace::from($trace);
// starts from just after where we found $caller1
$caller2 = FilterBacktrace::from($trace, [], $caller1['stackIndex'] + 1);</code></pre>
<p>If you attempt to search beyond the end of the stack trace, <code>FilterBacktrace</code> will return the last stack frame.</p>
<h2 id="return-value">Return Value</h2>
<p><code>FilterBacktrace</code> returns an array:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>class</td>
<td>A valid PHP class name, or NULL</td>
</tr>
<tr>
<td>function</td>
<td>The method on the class that called us, or NULL</td>
</tr>
<tr>
<td>file</td>
<td>The file were the PHP code was defined, or NULL</td>
</tr>
<tr>
<td>line</td>
<td>The line number in the file where the PHP code was defined, or NULL</td>
</tr>
<tr>
<td>stackIndex</td>
<td>Where did we find these details in the backtrace array?</td>
</tr>
</tbody>
</table>
<p>You should expect some of the fields in the return array to be <code>NULL</code>:</p>
<ul>
<li>Any entry in the returned array can be <code>NULL</code>.</li>
<li>One of <code>class</code>, <code>class</code> and <code>function</code>, or <code>file</code> will have a value.</li>
</ul>
<h2 id="notes">Notes</h2>
<p>None at this time.</p>
<h2 id="changelog">Changelog</h2>
<h3 id="v12016052501">v1.2016052501</h3>
<ul>
<li>
<p><code>FilterBacktrace</code> now extends the <a href="http://ganbarodigital.github.io/php-the-missing-bits/traces/FilterBacktrace.html"><code>FilterBacktrace</code></a> from <a href="http://ganbarodigital.github.io/php-the-missing-bits/">PHP: The Missing Bits</a>.</p>
<p>We didn't want projects depending upon <code>ganbarodigital/php-mv-exception-helpers</code> just because they wanted to add caller details to log messages. We've moved <code>FilterBacktrace</code> into <a href="http://ganbarodigital.github.io/php-the-missing-bits/">PHP: The Missing Bits</a> where it probably always belonged.</p>
</li>
<li>
<p><code>FilterBacktrace</code> no longer filters out partial namespaces.</p>
<p>This was a disaster waiting to happen. Filtering partial namespaces meant that we'd filter out your namespaces too - and that's a violation of the rule of no surprises. It's just too blunt an instrument. We've switched to filtering out whole namespaces only to make sure that we never filter out your namespaces when we meant to only filter out our namespaces.</p>
</li>
</ul>
<h3 id="v12016052401">v1.2016052401</h3>
<ul>
<li>
<p>the default value of <code>$index</code> parameter was changed to be <code>1</code>. The previous default was <code>0</code>.</p>
<p>This is a bug fix. Frame #0 of a debug stack trace can contain partial information - a <code>class</code> and <code>function</code> with no matching <code>file</code> and <code>line</code> data. Because we can never complete that information (the <code>file</code> and <code>line</code> would have to be a frame #-1, which does not exist), there's absolutely no point in starting the filtering from frame #0.</p>
</li>
</ul>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="FilterCodeCaller.html"><code>FilterCodeCaller</code> class</a></li>
</ul>
            </article>

                        <nav class="pageflow">
              <ul>
                                    <li><a href="CodeCaller.html">Prev: CodeCaller class</a></li>
                                                      <li><a href="FilterBacktraceForTwoCodeCallers.html">Next: FilterBacktraceForTwoCodeCallers class</a></li>
                                </ul>
            </nav>
                    </main>

        <aside class="sidebar">
            <h2>This Page</h2>
            <nav class="toc" data-type="ishi-toc" data-max-depth="3">
            </nav>
        </aside>
        <footer>
            <div class="strapline">
                <p>Copyright &copy; 2015 <a href="http://ganbarodigital.com">Ganbaro Digital Ltd</a>. Released under the <a href="http://ganbarodigital.github.io/php-mv-exception-helpers/license.html">New BSD</a> license.
                                            Find Exception Helpers Library for PHP on <a href="https://github.com/ganbarodigital/php-mv-exception-helpers">GitHub</a>.
                                        Built with <a href="http://couscous.io/">Couscous</a>.
                </p>
            </div>
        </footer>
    <script src="http://ganbarodigital.github.io/php-mv-exception-helpers/assets/laroux.js"></script>
    <script src="http://ganbarodigital.github.io/php-mv-exception-helpers/assets/ishi.js"></script>
    </body>
</html>
